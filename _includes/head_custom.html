<link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 1. Determine Current Language
        const path = window.location.pathname;
        const isPt = path.includes("/pt/") || path.endsWith("/pt");
        const currentLang = isPt ? "pt" : "en";

        // 2. Filter Sidebar Items
        const navItems = document.querySelectorAll('.nav-list-item');
        navItems.forEach(item => {
            const link = item.querySelector('.nav-list-link');
            if (!link) return;
            const href = link.getAttribute('href') || '';

            let itemLang = "common";
            if (href.includes("/pt/") || href.endsWith("/pt")) itemLang = "pt";
            else if (href.includes("/en/") || href.endsWith("/en")) itemLang = "en";

            if (currentLang === "pt" && itemLang === "en") {
                item.classList.add('lang-hidden');
            } else if (currentLang === "en" && itemLang === "pt") {
                item.classList.add('lang-hidden');
            }
        });

        // 3. Create Language Toggle in Header
        const auxNav = document.querySelector('.aux-nav-list');
        if (auxNav) {
            // Find and remove old English/Português links
            const oldLinks = auxNav.querySelectorAll('.aux-nav-list-item');
            oldLinks.forEach(li => {
                const a = li.querySelector('a');
                if (a && (a.textContent.includes('English') || a.textContent.includes('Português'))) {
                    li.remove();
                }
            });

            // Create new toggle
            const toggle = document.createElement('li');
            toggle.className = 'aux-nav-list-item';
            toggle.innerHTML = `
            <div class="lang-toggle">
                <a href="{{ site.baseurl }}/en/" class="${currentLang === 'en' ? 'active' : ''}">EN</a>
                <a href="{{ site.baseurl }}/pt/" class="${currentLang === 'pt' ? 'active' : ''}">PT</a>
            </div>
        `;
            auxNav.insertBefore(toggle, auxNav.firstChild);
        }

        // 4. Highlight active aux link
        const auxLinks = document.querySelectorAll('.aux-nav-list-item a');
        auxLinks.forEach(link => {
            if (link.href === window.location.href) {
                link.classList.add('lang-active');
            }
        });
    });
</script>